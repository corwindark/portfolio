<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corwin Dark">
<meta name="dcterms.date" content="2023-09-01">

<title>portfolio - Metalearning in Time Series Ensembles</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/favicon-32x32.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.qmd" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./dlensembling.html" rel="" target="" aria-current="page">
 <span class="menu-text">NN Ensembling</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Metalearning in Time Series Ensembles</h1>
<p class="subtitle lead">Using Deep Learning to Select Statistical Models</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Corwin Dark </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Get Hourly SPY Data Since 1/1/22</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> TimeSeriesSplit</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> yf.download(<span class="st">'SPY'</span>,<span class="st">'2022-01-01'</span>,<span class="st">'2023-09-30'</span>, interval <span class="op">=</span><span class="st">"60m"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'Adj Close'</span>].plot()</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>plt.ion()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[*********************100%%**********************]  1 of 1 completed
                           Open        High         Low       Close  \
Datetime                                                              
2022-01-03 09:30:00  476.299988  477.720001  473.850006  476.750000   
2022-01-03 10:30:00  476.739990  476.779999  475.049988  475.529999   
2022-01-03 11:30:00  475.540009  475.994995  474.450012  475.929993   
2022-01-03 12:30:00  475.929993  476.184998  475.334991  476.060089   
2022-01-03 13:30:00  476.084991  477.079987  475.869995  476.920013   
...                         ...         ...         ...         ...   
2023-09-29 11:30:00  430.000000  430.209503  428.635010  429.410004   
2023-09-29 12:30:00  429.429993  429.595001  426.500000  427.500000   
2023-09-29 13:30:00  427.494995  427.679993  426.010010  426.260010   
2023-09-29 14:30:00  426.269989  428.470001  425.910004  427.579987   
2023-09-29 15:30:00  427.589996  428.875000  426.739990  427.410004   

                      Adj Close    Volume  
Datetime                                   
2022-01-03 09:30:00  476.750000  16733361  
2022-01-03 10:30:00  475.529999   7596469  
2022-01-03 11:30:00  475.929993   5689415  
2022-01-03 12:30:00  476.060089   4203353  
2022-01-03 13:30:00  476.920013   5747186  
...                         ...       ...  
2023-09-29 11:30:00  429.410004   9596312  
2023-09-29 12:30:00  427.500000  12763406  
2023-09-29 13:30:00  426.260010  12485095  
2023-09-29 14:30:00  427.579987  16267060  
2023-09-29 15:30:00  427.410004  20067751  

[3056 rows x 6 columns]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dlensembling_files/figure-html/cell-2-output-2.png" width="575" height="412"></p>
</div>
</div>
<p>Now we need to split the data.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data.reset_index(inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>train_size <span class="op">=</span> <span class="dv">2400</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>data_train <span class="op">=</span> data[:train_size]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>data_test <span class="op">=</span> data[train_size:]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>test_size <span class="op">=</span> <span class="bu">len</span>(data_test)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>data_test <span class="op">=</span> data_test[[<span class="st">"Datetime"</span>, <span class="st">"Close"</span>]]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>data_train <span class="op">=</span> data_train[[<span class="st">"Datetime"</span>, <span class="st">"Close"</span>]]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>seriesTrain <span class="op">=</span> data_train.set_index(<span class="st">'Datetime'</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>seriesTest <span class="op">=</span> data_test.set_index(<span class="st">'Datetime'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Attempting to implement with sklearn tscv</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">tscvData = data[["Close"]]</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">tscv = TimeSeriesSplit(gap=0 max_train_size=None, n_splits=5, test_size=1)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">for i, (train_index, test_index) in enumerate(tscv.split(tscvData)):</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    print(i, "train: ", train_index, "test: ", test_index)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    model = auto_arima(tscvData[train_index])</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">    predictions = model.predict(n_periods = 1)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    print(predictions)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>'\ntscvData = data[["Close"]]\n\n\n# https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.TimeSeriesSplit.html\n\ntscv = TimeSeriesSplit(gap=0 max_train_size=None, n_splits=5, test_size=1)\n\nfor i, (train_index, test_index) in enumerate(tscv.split(tscvData)):\n    print(i, "train: ", train_index, "test: ", test_index)\n    model = auto_arima(tscvData[train_index])\n    predictions = model.predict(n_periods = 1)\n    print(predictions)\n'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's reformat the test data into a dataframe we can add our predictions to</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>testResultsDF <span class="op">=</span> pd.DataFrame(index <span class="op">=</span> <span class="bu">range</span>(test_size))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>testResultsDF[<span class="st">'Price'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a clean format for close prices</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,test_size):</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    testResultsDF[<span class="st">'Price'</span>][i] <span class="op">=</span> seriesTest.values[i][<span class="dv">0</span>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty cells for the statistical forecasts</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>testResultsDF[<span class="st">'auto_arima'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>testResultsDF[<span class="st">'dyn_theta'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>testResultsDF[<span class="st">'auto_ets'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>testResultsDF[<span class="st">'complex_smoothing'</span>] <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crossValidation(train, test, window, outputFrame, modelName, predReturnFunction):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    totalPredictions <span class="op">=</span> pd.Series([])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    windows <span class="op">=</span> <span class="bu">len</span>(test) <span class="op">//</span> window</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    predictionIndex <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, windows):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># debug</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Window: "</span>, i, <span class="st">"Method: "</span>, modelName)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># How many observations to move forward each frame</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        addNum <span class="op">=</span> i <span class="op">*</span> window</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Combine training data with additional test window</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        intermediateData <span class="op">=</span> pd.concat([train, test[:addNum]])</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate prediction of the given window size</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> predReturnFunction(intermediateData, window)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(prediction)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if we have multiple predictions in the window</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(prediction) <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Store each predicted value with a loop</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,window):</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Store in the prediction-comparison frame</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                outputFrame[modelName][predictionIndex] <span class="op">=</span> prediction[j]</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Move to next open spot</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                predictionIndex <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            outputFrame[modelName][predictionIndex] <span class="op">=</span> prediction[<span class="dv">0</span>]</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            predictionIndex <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then we need to train the statistical models</p>
<p>Import packages</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> AutoCES, AutoARIMA, AutoETS, DynamicOptimizedTheta</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\corwi\anaconda3\Lib\site-packages\statsforecast\core.py:21: TqdmExperimentalWarning:

Using `tqdm.autonotebook.tqdm` in notebook mode. Use `tqdm.tqdm` instead to force console mode (e.g. in jupyter console)
</code></pre>
</div>
</div>
<p>Run Prediction</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> aaPredFunction(dataIn, windowSize):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> AutoARIMA()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    fit1 <span class="op">=</span> model.fit(y <span class="op">=</span> np.concatenate(dataIn.to_numpy()))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> fit1.predict(h <span class="op">=</span> windowSize)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prediction.get(<span class="st">'mean'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cesPredFunction(dataIn, windowSize):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> AutoCES()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    fit1 <span class="op">=</span> model.fit(y <span class="op">=</span> np.concatenate(dataIn.to_numpy()))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    predictionList <span class="op">=</span> fit1.predict(windowSize)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predictionList.get(<span class="st">'mean'</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> etsPredFunction(dataIn, windowSize):</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> AutoETS()</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    fit1 <span class="op">=</span> model.fit(y <span class="op">=</span> np.concatenate(dataIn.to_numpy()))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    predictionList <span class="op">=</span> fit1.predict(windowSize)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predictionList.get(<span class="st">'mean'</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dotPredFunction(dataIn, windowSize):</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> DynamicOptimizedTheta()</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    fit1 <span class="op">=</span> model.fit(y <span class="op">=</span> np.concatenate(dataIn.to_numpy()))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    predictionList <span class="op">=</span> fit1.predict(windowSize)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> predictionList.get(<span class="st">'mean'</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of observations to be included in the test set</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>test_out_size <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>tempTest <span class="op">=</span> seriesTest[:test_out_size]</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto Arima</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>crossValidation(seriesTrain, tempTest, <span class="dv">1</span>, testResultsDF, <span class="st">'auto_arima'</span>, aaPredFunction)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>crossValidation(seriesTrain, tempTest, <span class="dv">1</span>, testResultsDF, <span class="st">'complex_smoothing'</span>, cesPredFunction)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>crossValidation(seriesTrain, tempTest, <span class="dv">1</span>, testResultsDF, <span class="st">'auto_ets'</span>, etsPredFunction)</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>crossValidation(seriesTrain, tempTest, <span class="dv">1</span>, testResultsDF, <span class="st">'dyn_theta'</span>, dotPredFunction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:3: FutureWarning:

The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:31: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:3: FutureWarning:

The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:31: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:3: FutureWarning:

The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:31: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:3: FutureWarning:

The default dtype for empty Series will be 'object' instead of 'float64' in a future version. Specify a dtype explicitly to silence this warning.

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\2670725450.py:31: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Window:  0 Method:  auto_arima
[411.29000854]
Window:  1 Method:  auto_arima
[411.70230103]
Window:  2 Method:  auto_arima
[410.25]
Window:  3 Method:  auto_arima
[411.73001099]
Window:  4 Method:  auto_arima
[412.11999512]
Window:  5 Method:  auto_arima
[412.85998535]
Window:  6 Method:  auto_arima
[415.22000122]
Window:  7 Method:  auto_arima
[415.2098999]
Window:  8 Method:  auto_arima
[414.65811157]
Window:  9 Method:  auto_arima
[415.23001099]
Window:  10 Method:  auto_arima
[416.89001465]
Window:  11 Method:  auto_arima
[417.29501343]
Window:  12 Method:  auto_arima
[416.15969849]
Window:  13 Method:  auto_arima
[416.14001465]
Window:  14 Method:  auto_arima
[416.53359985]
Window:  15 Method:  auto_arima
[417.78500366]
Window:  16 Method:  auto_arima
[419.23779297]
Window:  17 Method:  auto_arima
[420.57000732]
Window:  18 Method:  auto_arima
[418.51000977]
Window:  19 Method:  auto_arima
[418.22000122]
Window:  20 Method:  auto_arima
[418.76000977]
Window:  21 Method:  auto_arima
[417.87820435]
Window:  22 Method:  auto_arima
[418.18289185]
Window:  23 Method:  auto_arima
[418.60998535]
Window:  24 Method:  auto_arima
[419.13101196]
Window:  25 Method:  auto_arima
[419.290802]
Window:  26 Method:  auto_arima
[418.89498901]
Window:  27 Method:  auto_arima
[419.11499023]
Window:  28 Method:  auto_arima
[419.69500732]
Window:  29 Method:  auto_arima
[419.04501343]
Window:  30 Method:  auto_arima
[418.76998901]
Window:  31 Method:  auto_arima
[417.73001099]
Window:  32 Method:  auto_arima
[417.88000488]
Window:  33 Method:  auto_arima
[417.23001099]
Window:  34 Method:  auto_arima
[415.79000854]
Window:  35 Method:  auto_arima
[414.34500122]
Window:  36 Method:  auto_arima
[414.75]
Window:  37 Method:  auto_arima
[414.08999634]
Window:  38 Method:  auto_arima
[410.66000366]
Window:  39 Method:  auto_arima
[411.20999146]
Window:  0 Method:  complex_smoothing
[411.31210327]
Window:  1 Method:  complex_smoothing
[411.58743286]
Window:  2 Method:  complex_smoothing
[410.47836304]
Window:  3 Method:  complex_smoothing
[411.44396973]
Window:  4 Method:  complex_smoothing
[411.94665527]
Window:  5 Method:  complex_smoothing
[412.64120483]
Window:  6 Method:  complex_smoothing
[414.6685791]
Window:  7 Method:  complex_smoothing
[415.06469727]
Window:  8 Method:  complex_smoothing
[414.70376587]
Window:  9 Method:  complex_smoothing
[415.08825684]
Window:  10 Method:  complex_smoothing
[416.49438477]
Window:  11 Method:  complex_smoothing
[417.099823]
Window:  12 Method:  complex_smoothing
[416.31307983]
Window:  13 Method:  complex_smoothing
[416.13769531]
Window:  14 Method:  complex_smoothing
[416.41891479]
Window:  15 Method:  complex_smoothing
[417.47741699]
Window:  16 Method:  complex_smoothing
[418.85162354]
Window:  17 Method:  complex_smoothing
[420.19198608]
Window:  18 Method:  complex_smoothing
[418.8114624]
Window:  19 Method:  complex_smoothing
[418.30490112]
Window:  20 Method:  complex_smoothing
[418.6343689]
Window:  21 Method:  complex_smoothing
[417.99539185]
Window:  22 Method:  complex_smoothing
[418.11132812]
Window:  23 Method:  complex_smoothing
[418.47607422]
Window:  24 Method:  complex_smoothing
[418.96533203]
Window:  25 Method:  complex_smoothing
[419.19128418]
Window:  26 Method:  complex_smoothing
[418.91949463]
Window:  27 Method:  complex_smoothing
[419.04171753]
Window:  28 Method:  complex_smoothing
[419.5300293]
Window:  29 Method:  complex_smoothing
[419.1076355]
Window:  30 Method:  complex_smoothing
[418.80297852]
Window:  31 Method:  complex_smoothing
[417.9102478]
Window:  32 Method:  complex_smoothing
[417.85235596]
Window:  33 Method:  complex_smoothing
[417.31808472]
Window:  34 Method:  complex_smoothing
[416.06033325]
Window:  35 Method:  complex_smoothing
[414.65158081]
Window:  36 Method:  complex_smoothing
[414.6947937]
Window:  37 Method:  complex_smoothing
[414.17434692]
Window:  38 Method:  complex_smoothing
[411.32434082]
Window:  39 Method:  complex_smoothing
[411.19592285]
Window:  0 Method:  auto_ets
[411.29003674]
Window:  1 Method:  auto_ets
[411.7022598]
Window:  2 Method:  auto_ets
[410.25014523]
Window:  3 Method:  auto_ets
[411.729863]
Window:  4 Method:  auto_ets
[412.1199561]
Window:  5 Method:  auto_ets
[412.85991135]
Window:  6 Method:  auto_ets
[415.21976521]
Window:  7 Method:  auto_ets
[415.20990089]
Window:  8 Method:  auto_ets
[414.65816675]
Window:  9 Method:  auto_ets
[415.2299538]
Window:  10 Method:  auto_ets
[416.88984864]
Window:  11 Method:  auto_ets
[417.29497291]
Window:  12 Method:  auto_ets
[416.15981201]
Window:  13 Method:  auto_ets
[416.14001663]
Window:  14 Method:  auto_ets
[416.5335605]
Window:  15 Method:  auto_ets
[417.78487852]
Window:  16 Method:  auto_ets
[419.23764768]
Window:  17 Method:  auto_ets
[420.56987409]
Window:  18 Method:  auto_ets
[418.51021575]
Window:  19 Method:  auto_ets
[418.22003024]
Window:  20 Method:  auto_ets
[418.75995577]
Window:  21 Method:  auto_ets
[417.87829252]
Window:  22 Method:  auto_ets
[418.18286139]
Window:  23 Method:  auto_ets
[418.60994264]
Window:  24 Method:  auto_ets
[419.13095986]
Window:  25 Method:  auto_ets
[419.29078602]
Window:  26 Method:  auto_ets
[418.89502859]
Window:  27 Method:  auto_ets
[419.11496824]
Window:  28 Method:  auto_ets
[419.69494932]
Window:  29 Method:  auto_ets
[419.04507842]
Window:  30 Method:  auto_ets
[418.77001652]
Window:  31 Method:  auto_ets
[417.73011499]
Window:  32 Method:  auto_ets
[417.87998989]
Window:  33 Method:  auto_ets
[417.23007598]
Window:  34 Method:  auto_ets
[415.79015255]
Window:  35 Method:  auto_ets
[414.34514574]
Window:  36 Method:  auto_ets
[414.74995951]
Window:  37 Method:  auto_ets
[414.09006233]
Window:  38 Method:  auto_ets
[410.66034667]
Window:  39 Method:  auto_ets
[411.20993649]
Window:  0 Method:  dyn_theta
[411.29284668]
Window:  1 Method:  dyn_theta
[411.69821167]
Window:  2 Method:  dyn_theta
[410.26449585]
Window:  3 Method:  dyn_theta
[411.71536255]
Window:  4 Method:  dyn_theta
[412.11593628]
Window:  5 Method:  dyn_theta
[412.85253906]
Window:  6 Method:  dyn_theta
[415.19631958]
Window:  7 Method:  dyn_theta
[415.20977783]
Window:  8 Method:  dyn_theta
[414.66363525]
Window:  9 Method:  dyn_theta
[415.22433472]
Window:  10 Method:  dyn_theta
[416.87335205]
Window:  11 Method:  dyn_theta
[417.290802]
Window:  12 Method:  dyn_theta
[416.17102051]
Window:  13 Method:  dyn_theta
[416.14031982]
Window:  14 Method:  dyn_theta
[416.52966309]
Window:  15 Method:  dyn_theta
[417.77246094]
Window:  16 Method:  dyn_theta
[419.22314453]
Window:  17 Method:  dyn_theta
[420.55654907]
Window:  18 Method:  dyn_theta
[418.53048706]
Window:  19 Method:  dyn_theta
[418.22311401]
Window:  20 Method:  dyn_theta
[418.75463867]
Window:  21 Method:  dyn_theta
[417.88696289]
Window:  22 Method:  dyn_theta
[418.17993164]
Window:  23 Method:  dyn_theta
[418.60568237]
Window:  24 Method:  dyn_theta
[419.12576294]
Window:  25 Method:  dyn_theta
[419.28915405]
Window:  26 Method:  dyn_theta
[418.89892578]
Window:  27 Method:  dyn_theta
[419.11282349]
Window:  28 Method:  dyn_theta
[419.68917847]
Window:  29 Method:  dyn_theta
[419.05145264]
Window:  30 Method:  dyn_theta
[418.77279663]
Window:  31 Method:  dyn_theta
[417.740448]
Window:  32 Method:  dyn_theta
[417.87860107]
Window:  33 Method:  dyn_theta
[417.23651123]
Window:  34 Method:  dyn_theta
[415.80447388]
Window:  35 Method:  dyn_theta
[414.35958862]
Window:  36 Method:  dyn_theta
[414.74609375]
Window:  37 Method:  dyn_theta
[414.09655762]
Window:  38 Method:  dyn_theta
[410.69436646]
Window:  39 Method:  dyn_theta
[411.20483398]</code></pre>
</div>
</div>
<p>Let’s try and visualize the cross-validated auto-arima performance</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(testResultsDF)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plot1 <span class="op">=</span> testResultsDF.iloc[<span class="dv">0</span>:test_out_size,:]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the index as a column for plotting</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plot1 <span class="op">=</span> plot1.reset_index()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plot1 <span class="op">=</span> pd.melt(plot1, id_vars <span class="op">=</span> [<span class="st">'index'</span>], value_vars <span class="op">=</span>  [<span class="st">'auto_arima'</span>, <span class="st">'auto_ets'</span>, <span class="st">'complex_smoothing'</span>, <span class="st">'dyn_theta'</span>, <span class="st">'Price'</span>])</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(plot1)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>sns.lineplot(plot1, x <span class="op">=</span> <span class="st">'index'</span>, y <span class="op">=</span> <span class="st">'value'</span>, hue <span class="op">=</span> <span class="st">'variable'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Price  auto_arima   dyn_theta    auto_ets  complex_smoothing
0    411.702301  411.290009  411.292847  411.290037         411.312103
1    410.250000  411.702301  411.698212  411.702260         411.587433
2    411.730011  410.250000  410.264496  410.250145         410.478363
3    412.119995  411.730011  411.715363  411.729863         411.443970
4    412.859985  412.119995  412.115936  412.119956         411.946655
..          ...         ...         ...         ...                ...
651  429.410004    0.000000    0.000000    0.000000           0.000000
652  427.500000    0.000000    0.000000    0.000000           0.000000
653  426.260010    0.000000    0.000000    0.000000           0.000000
654  427.579987    0.000000    0.000000    0.000000           0.000000
655  427.410004    0.000000    0.000000    0.000000           0.000000

[656 rows x 5 columns]
     index    variable       value
0        0  auto_arima  411.290009
1        1  auto_arima  411.702301
2        2  auto_arima  410.250000
3        3  auto_arima  411.730011
4        4  auto_arima  412.119995
..     ...         ...         ...
195     35       Price  414.750000
196     36       Price  414.089996
197     37       Price  410.660004
198     38       Price  411.209991
199     39       Price  410.010010

[200 rows x 3 columns]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>&lt;Axes: xlabel='index', ylabel='value'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dlensembling_files/figure-html/cell-10-output-3.png" width="593" height="429"></p>
</div>
</div>
<p>Let’s get a more detailed plot of how close each method is at each increment</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(testResultsDF)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plot2 <span class="op">=</span> testResultsDF.iloc[<span class="dv">0</span>:test_out_size,:]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plot2[<span class="st">'auto_arima'</span>] <span class="op">=</span> plot2[<span class="st">'auto_arima'</span>] <span class="op">-</span> plot2[<span class="st">'Price'</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plot2[<span class="st">'auto_ets'</span>] <span class="op">=</span> plot2[<span class="st">'auto_ets'</span>] <span class="op">-</span> plot2[<span class="st">'Price'</span>]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plot2[<span class="st">'complex_smoothing'</span>] <span class="op">=</span> plot2[<span class="st">'complex_smoothing'</span>] <span class="op">-</span> plot2[<span class="st">'Price'</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plot2[<span class="st">'dyn_theta'</span>] <span class="op">=</span> plot2[<span class="st">'dyn_theta'</span>] <span class="op">-</span> plot2[<span class="st">'Price'</span>]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># get the index as a column for plotting</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>plot2 <span class="op">=</span> plot2.reset_index()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>errorDat <span class="op">=</span> plot2.copy()</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>plot2 <span class="op">=</span> pd.melt(plot2, id_vars <span class="op">=</span> [<span class="st">'index'</span>], value_vars <span class="op">=</span>  [<span class="st">'auto_arima'</span>, <span class="st">'auto_ets'</span>, <span class="st">'complex_smoothing'</span>, <span class="st">'dyn_theta'</span>])</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>sns.barplot(plot2, x <span class="op">=</span> <span class="st">'index'</span>, y <span class="op">=</span> <span class="st">'value'</span>, hue <span class="op">=</span> <span class="st">'variable'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Price  auto_arima   dyn_theta    auto_ets  complex_smoothing
0    411.702301  411.290009  411.292847  411.290037         411.312103
1    410.250000  411.702301  411.698212  411.702260         411.587433
2    411.730011  410.250000  410.264496  410.250145         410.478363
3    412.119995  411.730011  411.715363  411.729863         411.443970
4    412.859985  412.119995  412.115936  412.119956         411.946655
..          ...         ...         ...         ...                ...
651  429.410004    0.000000    0.000000    0.000000           0.000000
652  427.500000    0.000000    0.000000    0.000000           0.000000
653  426.260010    0.000000    0.000000    0.000000           0.000000
654  427.579987    0.000000    0.000000    0.000000           0.000000
655  427.410004    0.000000    0.000000    0.000000           0.000000

[656 rows x 5 columns]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\4142167574.py:5: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\4142167574.py:6: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\4142167574.py:7: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

C:\Users\corwi\AppData\Local\Temp\ipykernel_30724\4142167574.py:8: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;Axes: xlabel='index', ylabel='value'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dlensembling_files/figure-html/cell-11-output-4.png" width="589" height="429"></p>
</div>
</div>
<p>Let’s look at cumulative absolute error of the models, compared to best choice at each time point</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>errorDat[<span class="st">'optimal'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, errorDat.shape[<span class="dv">0</span>]):</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(index)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    predictionErrors <span class="op">=</span> errorDat.loc[:,(<span class="st">'auto_arima'</span>, <span class="st">'auto_ets'</span>, <span class="st">'dyn_theta'</span>, <span class="st">'complex_smoothing'</span>) ]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(predictionErrors.<span class="bu">min</span>())</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    errorDat.loc[index ,<span class="st">'optimal'</span>] <span class="op">=</span> <span class="bu">min</span>(predictionErrors)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>errorDat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
1
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
2
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
3
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
4
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
5
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
6
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
7
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
8
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
9
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
10
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
11
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
12
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
13
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
14
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
15
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
16
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
17
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
18
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
19
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
20
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
21
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
22
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
23
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
24
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
25
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
26
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
27
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
28
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
29
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
30
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
31
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
32
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
33
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
34
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
35
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
36
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
37
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
38
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64
39
auto_arima          -2.360016
auto_ets            -2.360090
dyn_theta           -2.367462
complex_smoothing   -2.578796
dtype: float64</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">auto_arima</th>
<th data-quarto-table-cell-role="th">dyn_theta</th>
<th data-quarto-table-cell-role="th">auto_ets</th>
<th data-quarto-table-cell-role="th">complex_smoothing</th>
<th data-quarto-table-cell-role="th">optimal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>411.702301</td>
<td>-0.412292</td>
<td>-0.409454</td>
<td>-0.412264</td>
<td>-0.390198</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>410.250000</td>
<td>1.452301</td>
<td>1.448212</td>
<td>1.452260</td>
<td>1.337433</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>411.730011</td>
<td>-1.480011</td>
<td>-1.465515</td>
<td>-1.479866</td>
<td>-1.251648</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>412.119995</td>
<td>-0.389984</td>
<td>-0.404633</td>
<td>-0.390132</td>
<td>-0.676025</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>412.859985</td>
<td>-0.739990</td>
<td>-0.744049</td>
<td>-0.740029</td>
<td>-0.913330</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>5</td>
<td>415.220001</td>
<td>-2.360016</td>
<td>-2.367462</td>
<td>-2.360090</td>
<td>-2.578796</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>6</td>
<td>415.209900</td>
<td>0.010101</td>
<td>-0.013580</td>
<td>0.009865</td>
<td>-0.541321</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>7</td>
<td>414.658112</td>
<td>0.551788</td>
<td>0.551666</td>
<td>0.551789</td>
<td>0.406586</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>8</td>
<td>415.230011</td>
<td>-0.571899</td>
<td>-0.566376</td>
<td>-0.571844</td>
<td>-0.526245</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>9</td>
<td>416.890015</td>
<td>-1.660004</td>
<td>-1.665680</td>
<td>-1.660061</td>
<td>-1.801758</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>10</td>
<td>417.295013</td>
<td>-0.404999</td>
<td>-0.421661</td>
<td>-0.405165</td>
<td>-0.800629</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>11</td>
<td>416.159698</td>
<td>1.135315</td>
<td>1.131104</td>
<td>1.135274</td>
<td>0.940125</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>12</td>
<td>416.140015</td>
<td>0.019684</td>
<td>0.031006</td>
<td>0.019797</td>
<td>0.173065</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>13</td>
<td>416.533600</td>
<td>-0.393585</td>
<td>-0.393280</td>
<td>-0.393583</td>
<td>-0.395905</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>14</td>
<td>417.785004</td>
<td>-1.251404</td>
<td>-1.255341</td>
<td>-1.251443</td>
<td>-1.366089</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>15</td>
<td>419.237793</td>
<td>-1.452789</td>
<td>-1.465332</td>
<td>-1.452914</td>
<td>-1.760376</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>16</td>
<td>420.570007</td>
<td>-1.332214</td>
<td>-1.346863</td>
<td>-1.332360</td>
<td>-1.718384</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>17</td>
<td>418.510010</td>
<td>2.059998</td>
<td>2.046539</td>
<td>2.059864</td>
<td>1.681976</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>18</td>
<td>418.220001</td>
<td>0.290009</td>
<td>0.310486</td>
<td>0.290215</td>
<td>0.591461</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>19</td>
<td>418.760010</td>
<td>-0.540009</td>
<td>-0.536896</td>
<td>-0.539980</td>
<td>-0.455109</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>20</td>
<td>417.878204</td>
<td>0.881805</td>
<td>0.876434</td>
<td>0.881751</td>
<td>0.756165</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>21</td>
<td>418.182892</td>
<td>-0.304688</td>
<td>-0.295929</td>
<td>-0.304599</td>
<td>-0.187500</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>22</td>
<td>418.609985</td>
<td>-0.427094</td>
<td>-0.430054</td>
<td>-0.427124</td>
<td>-0.498657</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>23</td>
<td>419.131012</td>
<td>-0.521027</td>
<td>-0.525330</td>
<td>-0.521069</td>
<td>-0.654938</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>24</td>
<td>419.290802</td>
<td>-0.159790</td>
<td>-0.165039</td>
<td>-0.159842</td>
<td>-0.325470</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>25</td>
<td>418.894989</td>
<td>0.395813</td>
<td>0.394165</td>
<td>0.395797</td>
<td>0.296295</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>26</td>
<td>419.114990</td>
<td>-0.220001</td>
<td>-0.216064</td>
<td>-0.219962</td>
<td>-0.195496</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>27</td>
<td>419.695007</td>
<td>-0.580017</td>
<td>-0.582184</td>
<td>-0.580039</td>
<td>-0.653290</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>28</td>
<td>419.045013</td>
<td>0.649994</td>
<td>0.644165</td>
<td>0.649936</td>
<td>0.485016</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>29</td>
<td>418.769989</td>
<td>0.275024</td>
<td>0.281464</td>
<td>0.275089</td>
<td>0.337646</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>30</td>
<td>417.730011</td>
<td>1.039978</td>
<td>1.042786</td>
<td>1.040006</td>
<td>1.072968</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>31</td>
<td>417.880005</td>
<td>-0.149994</td>
<td>-0.139557</td>
<td>-0.149890</td>
<td>0.030243</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>32</td>
<td>417.230011</td>
<td>0.649994</td>
<td>0.648590</td>
<td>0.649979</td>
<td>0.622345</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>33</td>
<td>415.790009</td>
<td>1.440002</td>
<td>1.446503</td>
<td>1.440067</td>
<td>1.528076</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>34</td>
<td>414.345001</td>
<td>1.445007</td>
<td>1.459473</td>
<td>1.445151</td>
<td>1.715332</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>35</td>
<td>414.750000</td>
<td>-0.404999</td>
<td>-0.390411</td>
<td>-0.404854</td>
<td>-0.098419</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>36</td>
<td>414.089996</td>
<td>0.660004</td>
<td>0.656097</td>
<td>0.659963</td>
<td>0.604797</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>37</td>
<td>410.660004</td>
<td>3.429993</td>
<td>3.436554</td>
<td>3.430059</td>
<td>3.514343</td>
<td>auto_arima</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>38</td>
<td>411.209991</td>
<td>-0.549988</td>
<td>-0.515625</td>
<td>-0.549645</td>
<td>0.114349</td>
<td>auto_arima</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>39</td>
<td>410.010010</td>
<td>1.199982</td>
<td>1.194824</td>
<td>1.199927</td>
<td>1.185913</td>
<td>auto_arima</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>backN = 50</p>
<p>smallTest = seriesTest[:test_out_size] smallTrain = seriesTrain[-backN:]</p>
<p>smallTest[“x”] = range(backN + 1,backN + test_out_size + 1) smallTrain[“x”] = range(1,backN + 1)</p>
<p>#aaPrediction = pd.Series(aaPrediction) #aaPrediction.index = smallTest.index #aaPrediction = pd.Series(aaPrediction) #aaPrediction.index = smallTest.index aaPrediction2 = pd.DataFrame([float(x) for x in aaPrediction]) aaPrediction2[“x”] = range(backN + 1, backN + test_out_size + 1) aaPrediction2.rename(columns = {0 : “val”, “x”: “x”}, inplace = True ) aaPrediction2 = pd.DataFrame(aaPrediction2)</p>
<p>print(aaPrediction)</p>
<p>plt.figure(figsize= (8,5) ) plt.plot(smallTrain[“x”], smallTrain[“Close”], label = “Training”) plt.plot(smallTest[“x”], smallTest[“Close”], label = “Test”) plt.plot(aaPrediction2[“x”], aaPrediction2[“val”], label = “Auto Arima”) plt.legend(loc = ‘upper left’) plt.show()</p>
<p>And then we can reformat data for NN</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>